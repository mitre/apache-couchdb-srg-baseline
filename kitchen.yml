---
driver:
  name: vagrant

provisioner:
  name: chef_solo

verifier: 
  name: inspec
  sudo: true
  load_plugins: true
  reporter: 
    - cli
    - json:./results/couchdb-vanilla-results.json
  inspec_tests: 
    - path: ./controls
    
    #Modify for specific control
  controls:
    - V-32468
    - V-32469
    - V-32475
    - V-32480
    - V-32523
    - V-58049
    - V-58051
    - V-58055
    - V-58059
    - V-58063
    - V-58065
    - V-58123
    - V-58127
    - V-58137
    - V-58149
    - V-58151
    - V-58153
    - V-58155
    - V-58157
    - V-58163
    - V-58165
    - V-58167
    - V-58177
    - V-58183
    - V-61407
  input_files:
    - ./inputs.yml

platforms:
  - name: centos-7
    lifecycle:
     post_create:
      - remote: sudo touch /etc/yum.repos.d/bintray-apache-couchdb-rpm.repo
      - remote: echo '[bintray--apache-couchdb-rpm]' |sudo tee -a /etc/yum.repos.d/bintray-apache-couchdb-rpm.repo
      - remote: echo 'name=bintray--apache-couchdb-rpm' |sudo tee -a /etc/yum.repos.d/bintray-apache-couchdb-rpm.repo
      - remote: echo 'baseurl=http://apache.bintray.com/couchdb-rpm/el$releasever/$basearch/' |sudo tee -a /etc/yum.repos.d/bintray-apache-couchdb-rpm.repo
      - remote: echo 'gpgcheck=0' |sudo tee -a /etc/yum.repos.d/bintray-apache-couchdb-rpm.repo
      - remote: echo 'repo_gpgcheck=0' |sudo tee -a /etc/yum.repos.d/bintray-apache-couchdb-rpm.repo
      - remote: echo 'enabled=1' |sudo tee -a /etc/yum.repos.d/bintray-apache-couchdb-rpm.repo
      - remote: sudo yum -y install epel-release && sudo yum -y install couchdb
      - remote: sudo sed -i '/\[admins]/a admin = mysecretpassword' /opt/couchdb/etc/local.ini
      - remote: sudo sed -i '/\[couchdb]/a single_node = true' /opt/couchdb/etc/local.ini
      - remote: sudo systemctl restart couchdb
      - remote: sudo systemctl start couchdb

    driver: 
      box: bento/centos-7

suites:
  - name: couchdb
    run_list:
    attributes:
